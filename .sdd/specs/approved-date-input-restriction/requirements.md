# Requirements Document

## Introduction
本機能は、工数記録画面において承認済みの日付に対する入力を制限することで、承認ワークフローの整合性を保ち、データの完全性を確保します。承認済みデータの誤った変更を防ぎ、監査証跡の信頼性を維持することで、システム全体の品質向上に貢献します。

## Requirements

### Requirement 1: 承認済み日付の入力制限
**User Story:** 開発者として、承認済みの日付に対して誤って工数データを変更することを防ぎたい。これにより、承認済みデータの完全性が保証される。

#### Acceptance Criteria
1. WHEN ユーザーが工数記録画面を開いた時 THEN システムは各日付の承認ステータスを確認する
2. IF 特定の日付が承認済み（APPROVED）である場合 THEN システムはその日付の全ての入力フィールドを無効化する
3. WHEN ユーザーが承認済み日付の入力フィールドにフォーカスしようとした時 THEN システムは入力を受け付けない
4. IF 日付が未承認（PENDING）または却下（REJECTED）の場合 THEN システムは通常通り入力を許可する
5. WHILE 承認ステータスが変更されている間 THE SYSTEM SHALL 画面の入力制限状態をリアルタイムで更新する

### Requirement 2: 視覚的フィードバック
**User Story:** 開発者として、どの日付が承認済みで編集不可能かを一目で理解したい。これにより、無駄な入力試行を避けることができる。

#### Acceptance Criteria
1. WHEN 日付が承認済みである場合 THEN システムは該当する入力フィールドをグレーアウト表示する
2. IF 入力フィールドが無効化されている場合 THEN システムは背景色を#f5f5f5（薄いグレー）に設定する
3. WHEN ユーザーが無効化されたフィールドにマウスオーバーした時 THEN システムはカーソルを「not-allowed」アイコンに変更する
4. WHERE 承認済み日付の行が表示される場所 THE SYSTEM SHALL 「承認済み」ラベルまたはアイコンを表示する
5. IF カテゴリ別工数入力フィールドが承認済みの場合 THEN システムは全てのカテゴリ入力欄を一括でグレーアウトする
6. WHEN 承認済み日付の工数記録セクションが表示される時 THEN システムは該当セクションの上部に承認済みバナーを表示する
7. IF 承認済みバナーが表示される場合 THEN システムは赤色の背景（#f44336）に白文字で「🔒 承認済み - 編集不可」と表示する
8. WHERE 承認済みバナーが配置される場所 THE SYSTEM SHALL 日付ヘッダーの直下に固定幅で表示し、承認日時と承認者名を含める

### Requirement 3: 承認ステータスの取得と連携
**User Story:** システム管理者として、承認ステータスが正確にフロントエンドに反映されることを確実にしたい。これにより、データの整合性が保たれる。

#### Acceptance Criteria
1. WHEN 工数記録画面が初期表示される時 THEN システムはWorkRecordApprovalエンティティから該当ユーザーの承認ステータスを取得する
2. IF APIから承認ステータスの取得に失敗した場合 THEN システムはエラーメッセージを表示し、デフォルトで編集可能状態を維持する
3. WHEN 承認ステータスが変更された時 THEN システムは5秒以内に画面の入力制限を更新する
4. WHERE 複数日付が表示される画面 THE SYSTEM SHALL 各日付の承認ステータスを個別に管理する
5. IF ユーザーが画面をリフレッシュした場合 THEN システムは最新の承認ステータスを再取得する

### Requirement 4: ユーザーへの通知とガイダンス
**User Story:** 開発者として、なぜ特定の日付が編集できないのかを理解したい。これにより、適切なアクションを取ることができる。

#### Acceptance Criteria
1. WHEN ユーザーが承認済み日付の編集を試みた時 THEN システムは「この日付は承認済みのため編集できません」というツールチップを表示する
2. IF 承認済み日付に対して保存操作が試みられた場合 THEN システムは「承認済みの日付は変更できません」というトーストメッセージを表示する
3. WHEN 承認済みバナーが表示される時 THEN システムは承認日時（YYYY/MM/DD HH:mm形式）と承認者名をバナー内に表示する
4. WHERE ヘルプアイコンが表示される場所 THE SYSTEM SHALL 承認済み日付の編集制限に関する説明を提供する
5. IF ユーザーが承認の取り消しを必要とする場合 THEN システムは上司への連絡方法を案内する
6. WHEN 承認済みバナーにマウスオーバーした時 THEN システムは詳細な承認情報（承認コメントがある場合）をツールチップで表示する

### Requirement 5: パフォーマンスとユーザビリティ
**User Story:** 開発者として、承認ステータスのチェックによって画面の応答性が低下しないことを期待する。これにより、快適な操作体験が維持される。

#### Acceptance Criteria
1. WHEN 承認ステータスをチェックする時 THEN システムは200ミリ秒以内に処理を完了する
2. IF 複数日付の承認ステータスを取得する場合 THEN システムはバッチ処理で一括取得する
3. WHILE 承認ステータスを取得中 THE SYSTEM SHALL ローディングインジケータを表示する
4. WHERE キャッシュ可能な承認ステータス THE SYSTEM SHALL 5分間のクライアントサイドキャッシュを実装する
5. WHEN ネットワークエラーが発生した場合 THEN システムは3回まで自動リトライを行う

### Requirement 6: データ整合性とセキュリティ
**User Story:** システム管理者として、フロントエンドの制限が回避されてもバックエンドでデータが保護されることを確実にしたい。これにより、システムの信頼性が保証される。

#### Acceptance Criteria
1. WHEN 承認済み日付のデータ更新リクエストが送信された時 THEN バックエンドAPIは変更を拒否し、HTTP 403エラーを返す
2. IF フロントエンドの制限が何らかの方法で回避された場合 THEN バックエンドは承認済みデータの変更を許可しない
3. WHERE 承認ステータスの検証が必要な場所 THE SYSTEM SHALL WorkRecordApprovalRepositoryを使用して最新状態を確認する
4. WHEN 不正な更新試行が検出された場合 THEN システムは監査ログに記録する
5. IF 管理者権限を持つユーザーの場合 THEN システムは特別な承認取り消しフローを提供する可能性を検討する