# 実装タスク

## プロジェクト概要
製品開発工数管理ツールの実装タスク一覧。Java 17 + Spring Boot 3.x + DDD アーキテクチャを使用し、PMOと開発者向けの工数管理機能を提供する。

## 実装フェーズ構成

### フェーズ1: プロジェクト基盤構築
**目的**: 開発環境とプロジェクト基盤の準備

#### T001: 開発環境セットアップ
**優先度**: Critical  
**見積工数**: 4時間  
**担当**: インフラ担当者  
**依存関係**: なし

**タスク内容**:
1. Spring Boot CLI インストール (brew tap spring-io/tap && brew install spring-boot)
2. プロジェクト初期化
   ```bash
   spring init \
     --build=gradle \
     --java-version=17 \
     --packaging=jar \
     --name=development-hour-management \
     --group-id=com.devhour \
     --artifact-id=development-hour-management \
     --package-name=com.devhour \
     --description="Development hour management tool for PMO and developers" \
     --dependencies=web,security,mybatis,mysql,flyway,validation,devtools,actuator \
     backend
   ```
3. Docker Compose ファイル作成 (MySQL 8.0 設定)
4. 開発用環境変数設定ファイル作成
5. プロジェクト構造のDDD対応リファクタリング

**完了条件**:
- [ ] Spring Boot アプリケーションが正常起動する
- [ ] MySQL データベースが Docker で起動する
- [ ] DDD フォルダ構造が整備されている
- [ ] 基本的なヘルスチェックが動作する

---

#### T002: データベース設計実装
**優先度**: Critical  
**見積工数**: 6時間  
**担当**: バックエンドエンジニア  
**依存関係**: T001

**タスク内容**:
1. Flyway マイグレーションファイル作成
   - V1__create_users_table.sql
   - V2__create_projects_table.sql
   - V3__create_project_assignments_table.sql
   - V4__create_work_categories_table.sql
   - V5__create_work_records_table.sql
2. 初期データ投入スクリプト作成
   - 管理者ユーザー作成
   - 作業カテゴリマスターデータ (BRD, PRD, Architecture, Dev, Operation, Meeting, Others)
3. データベース制約とインデックス設定
4. JSON TypeHandler for MyBatis 実装

**完了条件**:
- [ ] 全テーブルが正常に作成される
- [ ] 初期データが正しく投入される
- [ ] 外部キー制約が適切に設定されている
- [ ] JSON カラムの読み書きが正常動作する

---

### フェーズ2: ドメイン層実装
**目的**: ビジネスロジックの核となるドメイン層の構築

#### T003: ドメインエンティティ実装
**優先度**: High  
**見積工数**: 8時間  
**担当**: バックエンドエンジニア  
**依存関係**: T002

**タスク内容**:
1. Value Objects 実装
   - CategoryCode.java (カテゴリコード検証)
   - CategoryName.java (カテゴリ名検証)
   - DisplayOrder.java (表示順検証)
   - CategoryHours.java (工数JSON変換・検証)
   - ProjectStatus.java (プロジェクト状態)
2. Entity 実装
   - Project.java (プロジェクトエンティティ + ビジネスルール)
   - User.java (ユーザーエンティティ)
   - WorkRecord.java (工数記録エンティティ + 1日1レコード制御)
   - WorkCategory.java (作業カテゴリエンティティ)
   - ProjectAssignment.java (プロジェクトアサインエンティティ)
3. ドメインエンティティのファクトリーメソッド実装
4. ビジネスルール検証ロジック実装

**完了条件**:
- [ ] 全エンティティが DDD パターンに従って実装されている
- [ ] Value Objects が不変性を保持している
- [ ] ビジネスルール検証が適切に動作する
- [ ] エンティティのファクトリーメソッドが実装されている

**テストケース**:
- [ ] CategoryCode 検証 (正規表現マッチング)
- [ ] CategoryHours JSON 変換テスト
- [ ] WorkRecord 作成時の日付・工数検証
- [ ] Project 期間検証 (終了日 > 開始日)

---

#### T004: ドメインサービス実装
**優先度**: High  
**見積工数**: 6時間  
**担当**: バックエンドエンジニア  
**依存関係**: T003

**タスク内容**:
1. ProjectAllocationService.java 実装
   - 開発者アサインビジネスロジック
   - アサイン期間重複チェック
   - プロジェクト容量チェック
2. WorkHourCalculationService.java 実装
   - プロジェクト進捗計算ロジック
   - 開発者工数集計ロジック
   - カテゴリ別工数集計ロジック
3. ドメインサービスの単体テスト実装

**完了条件**:
- [ ] ProjectAllocationService が重複チェックを正しく行う
- [ ] WorkHourCalculationService が正確な集計を行う
- [ ] ドメインサービスがステートレスで実装されている
- [ ] 全ての計算ロジックにテストケースがある

**テストケース**:
- [ ] 開発者アサイン期間重複検出
- [ ] プロジェクト工数進捗率計算
- [ ] カテゴリ別工数集計の正確性

---

#### T005: リポジトリインターフェース定義
**優先度**: High  
**見積工数**: 3時間  
**担当**: バックエンドエンジニア  
**依存関係**: T003

**タスク内容**:
1. ドメイン層リポジトリインターフェース定義
   - ProjectRepository.java
   - UserRepository.java
   - WorkRecordRepository.java
   - WorkCategoryRepository.java
   - ProjectAssignmentRepository.java
2. リポジトリメソッドシグネチャ設計
3. クエリ仕様の明確化

**完了条件**:
- [ ] 全リポジトリインターフェースが定義されている
- [ ] メソッドシグネチャがドメインエンティティを使用している
- [ ] リポジトリが純粋にドメイン層に属している

---

### フェーズ3: アプリケーション層実装
**目的**: ユースケースの実装とビジネスフローの制御

#### T006: ユースケース実装
**優先度**: High  
**見積工数**: 10時間  
**担当**: バックエンドエンジニア  
**依存関係**: T004, T005

**タスク内容**:
1. CreateProjectUseCase.java 実装
   - プロジェクト作成ロジック
   - ビジネスルール適用
   - トランザクション管理
2. AssignDeveloperUseCase.java 実装
   - 開発者アサインロジック
   - 重複チェック実行
   - アサイン履歴管理
3. RecordWorkHourUseCase.java 実装
   - 工数記録ロジック
   - 1日1レコード制御
   - カテゴリ工数検証
4. GetWorkCategoriesUseCase.java 実装
   - アクティブカテゴリ取得
   - 表示順ソート
5. DTO クラス実装
   - ProjectDto, UserDto, WorkRecordDto, WorkCategoryDto
6. Command オブジェクト実装
   - CreateProjectCommand, AssignDeveloperCommand, RecordWorkHourCommand

**完了条件**:
- [ ] 全ユースケースが実装されている
- [ ] ドメインサービスとの連携が正常動作する
- [ ] トランザクション境界が適切に設定されている
- [ ] DTOとCommandの変換が正しく動作する

**テストケース**:
- [ ] プロジェクト作成の正常フロー
- [ ] 開発者アサインの重複検出
- [ ] 工数記録の検証エラーハンドリング
- [ ] アクティブカテゴリの取得と並び順

---

### フェーズ4: インフラストラクチャ層実装
**目的**: データ永続化とMyBatisマッパーの実装

#### T007: MyBatis マッパー実装
**優先度**: High  
**見積工数**: 12時間  
**担当**: バックエンドエンジニア  
**依存関係**: T002

**タスク内容**:
1. MyBatis アノテーションマッパー実装
   - ProjectMapper.java (@Select, @Insert, @Update, @Delete)
   - UserMapper.java (認証・ユーザー管理)
   - WorkRecordMapper.java (JSON TypeHandler使用)
   - WorkCategoryMapper.java (マスターデータ管理)
   - ProjectAssignmentMapper.java (アサイン管理)
2. 複雑クエリの実装
   - プロジェクト進捗集計クエリ
   - 開発者工数集計クエリ
   - カテゴリ別工数集計クエリ
3. JSON TypeHandler 詳細実装
4. MyBatis設定とConfiguration

**完了条件**:
- [ ] 全マッパーがアノテーションベースで実装されている
- [ ] 複雑な集計クエリが正常動作する
- [ ] JSON カラムの読み書きが正確に動作する
- [ ] データベースとオブジェクトのマッピングが正しい

**テストケース**:
- [ ] CRUD操作の全パターンテスト
- [ ] JSON データのシリアライズ・デシリアライズ
- [ ] 集計クエリの結果検証
- [ ] トランザクション動作確認

---

#### T008: リポジトリ実装クラス
**優先度**: High  
**見積工数**: 8時間  
**担当**: バックエンドエンジニア  
**依存関係**: T007

**タスク内容**:
1. MyBatis リポジトリ実装
   - MyBatisProjectRepository.java
   - MyBatisUserRepository.java
   - MyBatisWorkRecordRepository.java
   - MyBatisWorkCategoryRepository.java
   - MyBatisProjectAssignmentRepository.java
2. ドメインオブジェクトとMyBatisオブジェクト変換
3. エラーハンドリング実装
4. トランザクション管理

**完了条件**:
- [ ] 全リポジトリがドメインインターフェースを実装している
- [ ] MyBatisマッパーとの連携が正常動作する
- [ ] 例外ハンドリングが適切に行われている
- [ ] データベース制約エラーが適切に変換されている

**テストケース**:
- [ ] 統合テストでの全CRUD動作確認
- [ ] 制約違反エラーのハンドリング
- [ ] トランザクションロールバック動作

---

### フェーズ5: プレゼンテーション層実装
**目的**: REST APIとセキュリティの実装

#### T009: Spring Security + JWT 実装
**優先度**: Critical  
**見積工数**: 8時間  
**担当**: バックエンドエンジニア  
**依存関係**: T008

**タスク内容**:
1. SecurityConfig.java 実装
   - JWT認証設定
   - ロールベースアクセス制御
   - CORS設定
   - セキュリティヘッダー設定
2. JwtService.java 実装
   - JWT生成・検証・パース
   - トークンの有効期限管理
3. AuthController.java 実装
   - ログインエンドポイント
   - ユーザー情報取得
4. ユーザー認証・認可フィルター実装
5. カスタム例外ハンドリング

**完了条件**:
- [ ] JWT認証が正常動作する
- [ ] PMO・Developer ロール制御が機能する
- [ ] セキュリティ設定が適切に構成されている
- [ ] 認証エラー時の適切なレスポンスが返される

**テストケース**:
- [ ] 正常ログインフロー
- [ ] 不正ログイン試行時の拒否
- [ ] JWT有効期限切れ処理
- [ ] ロールベース認可の動作確認

---

#### T010: REST API コントローラー実装
**優先度**: High  
**見積工数**: 12時間  
**担当**: バックエンドエンジニア  
**依存関係**: T006, T009

**タスク内容**:
1. ProjectController.java 実装
   - GET /api/projects (プロジェクト一覧)
   - POST /api/projects (プロジェクト作成)
   - PUT /api/projects/{id} (プロジェクト更新)
   - DELETE /api/projects/{id} (プロジェクト削除)
   - POST /api/projects/{id}/assignments (開発者アサイン)
2. WorkRecordController.java 実装
   - GET /api/work-records/input-form (工数入力表取得)
   - POST /api/work-records (工数記録作成)
   - PUT /api/work-records/{id} (工数記録更新)
3. WorkCategoryController.java 実装
   - GET /api/work-categories (作業カテゴリ一覧)
4. Request/Response オブジェクト実装
5. バリデーション実装 (@Valid, カスタムバリデーター)
6. 例外ハンドリング (@ControllerAdvice)

**完了条件**:
- [ ] 全APIエンドポイントが実装されている
- [ ] リクエスト・レスポンスの形式が仕様通りである
- [ ] バリデーションが適切に動作する
- [ ] エラーレスポンスが統一されている

**テストケース**:
- [ ] 各エンドポイントの正常系テスト
- [ ] バリデーションエラーのテスト
- [ ] 権限不正アクセスのテスト
- [ ] APIレスポンス形式の検証

---

### フェーズ6: フロントエンド基盤実装
**目的**: Vue 3 + TypeScript + Vuetify によるフロントエンド基盤

#### T011: フロントエンドプロジェクト初期化
**優先度**: High  
**見積工数**: 4時間  
**担当**: フロントエンドエンジニア  
**依存関係**: T001

**タスク内容**:
1. Vue 3 + Vite プロジェクト作成
   ```bash
   npm create vue@latest frontend
   cd frontend
   npm install
   ```
2. TypeScript 設定強化
3. Vuetify 3 インストール・設定
4. ルーティング設定 (Vue Router)
5. 状態管理設定 (Pinia)
6. 環境変数設定 (.env files)
7. API クライアント設定 (Axios)

**完了条件**:
- [ ] Vue 3 アプリケーションが正常起動する
- [ ] Vuetify コンポーネントが使用可能
- [ ] TypeScript型チェックが動作する
- [ ] API通信の基盤が整っている

---

#### T012: 認証システム実装 (フロント)
**優先度**: Critical  
**見積工数**: 6時間  
**担当**: フロントエンドエンジニア  
**依存関係**: T009, T011

**タスク内容**:
1. 認証状態管理 (Pinia store)
2. ログインフォームコンポーネント
3. JWTトークンの自動送信設定
4. ルートガード実装 (認証確認)
5. ロールベースの画面制御
6. 自動ログアウト実装

**完了条件**:
- [ ] ログイン・ログアウトが正常動作する
- [ ] JWT認証がAPI通信で機能する
- [ ] PMO・Developer権限の画面制御ができる
- [ ] 認証状態の永続化ができている

**テストケース**:
- [ ] ログインフォームの動作
- [ ] 認証状態の保持
- [ ] 権限による画面制御
- [ ] 自動ログアウト

---

### フェーズ7: PMO機能実装
**目的**: プロジェクト管理機能の実装

#### T013: プロジェクト管理画面実装
**優先度**: High  
**見積工数**: 10時間  
**担当**: フロントエンドエンジニア  
**依存関係**: T010, T012

**タスク内容**:
1. ProjectListView.vue 実装
   - プロジェクト一覧テーブル
   - 進捗率表示
   - 消費工数・残工数表示
   - フィルター・ソート機能
2. ProjectFormDialog.vue 実装
   - プロジェクト作成・編集フォーム
   - バリデーション実装
   - 日付選択コンポーネント
3. プロジェクト削除確認ダイアログ
4. API連携とエラーハンドリング
5. レスポンシブデザイン対応

**完了条件**:
- [ ] プロジェクト一覧が正常表示される
- [ ] プロジェクトCRUD操作が全て動作する
- [ ] 進捗情報が正確に表示される
- [ ] フォームバリデーションが機能する

**テストケース**:
- [ ] プロジェクト作成フロー
- [ ] プロジェクト編集フロー
- [ ] プロジェクト削除フロー
- [ ] 一覧表示・フィルター機能

---

#### T014: 開発者アサイン機能実装
**優先度**: High  
**見積工数**: 8時間  
**担当**: フロントエンドエンジニア  
**依存関係**: T013

**タスク内容**:
1. DeveloperAssignDialog.vue 実装
   - 開発者選択コンポーネント
   - アサイン期間選択
   - 重複チェック結果表示
2. プロジェクト詳細画面でのアサイン管理
3. アサイン一覧表示機能
4. アサイン解除機能
5. カレンダー形式でのアサイン表示

**完了条件**:
- [ ] 開発者アサインが正常動作する
- [ ] アサイン期間の重複チェックが機能する
- [ ] アサイン状況が視覚的に確認できる
- [ ] アサイン解除が正常動作する

**テストケース**:
- [ ] 開発者アサイン機能
- [ ] アサイン期間重複検出
- [ ] アサイン一覧表示
- [ ] アサイン解除機能

---

### フェーズ8: 開発者機能実装
**目的**: 工数記録機能の実装

#### T015: 工数入力マトリックス実装
**優先度**: High  
**見積工数**: 12時間  
**担当**: フロントエンドエンジニア  
**依存関係**: T012

**タスク内容**:
1. WorkHourInputView.vue 実装
   - 日付選択機能
   - アサイン済みプロジェクト取得
   - 作業カテゴリマスター取得
2. WorkHourInputGrid.vue 実装
   - マトリックス形式の工数入力表
   - プロジェクト(行) × カテゴリ(列) のグリッド
   - 数値入力バリデーション
   - リアルタイム合計計算
3. 工数保存・更新機能
4. 過去データ編集機能
5. 入力データの一時保存機能

**完了条件**:
- [ ] マトリックス形式の工数入力表が動作する
- [ ] プロジェクトとカテゴリが正しく表示される
- [ ] 工数の保存・更新が正常動作する
- [ ] 合計工数の自動計算が機能する

**テストケース**:
- [ ] 工数入力フォームの動作
- [ ] 工数保存機能
- [ ] 過去データ編集機能
- [ ] 数値バリデーション

---

#### T016: 工数履歴表示機能
**優先度**: Medium  
**見積工数**: 6時間  
**担当**: フロントエンドエンジニア  
**依存関係**: T015

**タスク内容**:
1. 日別工数履歴表示
2. 週別工数集計表示
3. 月別工数集計表示
4. 期間指定検索機能
5. 工数データのCSVエクスポート機能

**完了条件**:
- [ ] 日別・週別・月別の工数表示ができる
- [ ] 期間指定での検索が機能する
- [ ] CSVエクスポートが正常動作する

---

### フェーズ9: 統合テスト・品質保証
**目的**: 全機能の統合テストと品質確保

#### T017: バックエンド統合テスト
**優先度**: Critical  
**見積工数**: 8時間  
**担当**: QAエンジニア + バックエンドエンジニア  
**依存関係**: T010

**タスク内容**:
1. API統合テスト実装
   - 全エンドポイントのE2Eテスト
   - 認証・認可テスト
   - データ整合性テスト
2. データベース統合テスト
   - トランザクション動作テスト
   - 制約違反処理テスト
   - JSON カラム操作テスト
3. パフォーマンステスト
   - レスポンス時間測定
   - 負荷テスト (JMeter)
4. セキュリティテスト
   - 脆弱性スキャン
   - 権限不正利用テスト

**完了条件**:
- [ ] 全APIエンドポイントが正常動作する
- [ ] セキュリティ要件を満たしている
- [ ] パフォーマンス目標を達成している
- [ ] データ整合性が保たれている

**テストケース**:
- [ ] 全APIの正常系・異常系テスト
- [ ] 認証・認可の全パターンテスト
- [ ] データベース制約テスト
- [ ] 負荷テスト・パフォーマンステスト

---

#### T018: フロントエンドE2Eテスト
**優先度**: Critical  
**見積工数**: 10時間  
**担当**: QAエンジニア + フロントエンドエンジニア  
**依存関係**: T016

**タスク内容**:
1. Cypress/Playwright E2Eテスト実装
2. 主要ユーザージャーニーテスト
   - PMOログイン → プロジェクト作成 → 開発者アサイン
   - 開発者ログイン → 工数入力 → 履歴確認
3. クロスブラウザテスト
4. レスポンシブデザインテスト
5. アクセシビリティテスト

**完了条件**:
- [ ] 全ユーザージャーニーが正常動作する
- [ ] 複数ブラウザで動作する
- [ ] モバイル端末で動作する
- [ ] アクセシビリティ基準を満たしている

**テストケース**:
- [ ] PMO機能の全フローテスト
- [ ] 開発者機能の全フローテスト
- [ ] クロスブラウザ動作確認
- [ ] モバイル対応確認

---

### フェーズ10: デプロイ・運用準備
**目的**: 本番環境への展開準備

#### T019: Docker化・CI/CD構築
**優先度**: High  
**見積工数**: 8時間  
**担当**: DevOpsエンジニア  
**依存関係**: T017, T018

**タスク内容**:
1. Dockerfile 作成 (フロント・バック)
2. docker-compose 本番用設定
3. CI/CDパイプライン構築
   - GitHub Actions または GitLab CI設定
   - 自動テスト実行
   - 自動ビルド・デプロイ
4. 環境別設定管理
5. セキュリティスキャン自動化

**完了条件**:
- [ ] Docker コンテナが正常起動する
- [ ] CI/CDパイプラインが動作する
- [ ] 自動テストがパイプラインで実行される
- [ ] セキュリティチェックが自動実行される

---

#### T020: 運用監視・ログ設定
**優先度**: Medium  
**見積工数**: 4時間  
**担当**: DevOpsエンジニア  
**依存関係**: T019

**タスク内容**:
1. アプリケーションログ設定
2. アクセスログ・エラーログ設定
3. ヘルスチェックエンドポイント実装
4. メトリクス収集設定 (Spring Boot Actuator)
5. アラート設定

**完了条件**:
- [ ] ログが適切に出力される
- [ ] ヘルスチェックが動作する
- [ ] メトリクス情報が取得できる
- [ ] 障害時のアラートが機能する

---

## 品質基準・完了条件

### コードカバレッジ要件
- **バックエンド**: 単体テスト 80%以上、統合テスト 70%以上
- **フロントエンド**: 単体テスト 75%以上、E2Eテスト 主要機能100%

### パフォーマンス要件
- API レスポンス時間 (P95): 200ms以下
- API レスポンス時間 (P99): 500ms以下
- 同時接続ユーザー: 100ユーザー以上

### セキュリティ要件
- OWASP Top 10 対策済み
- JWT有効期限管理
- SQL インジェクション対策
- XSS・CSRF対策

### 運用要件
- アプリケーション可用性: 99.5%以上
- 障害時の自動復旧機能
- バックアップ・リストア機能
- 監視・アラート機能

---

## リスク管理

### 高リスク項目
1. **JSON カラムの MyBatis 統合**: TypeHandler実装の複雑性
2. **フロントエンドのマトリックス UI**: パフォーマンスと使いやすさのバランス
3. **DDD アーキテクチャ**: 学習コストと実装複雑度

### リスク軽減策
1. **早期プロトタイプ作成**: 技術的難易度の高い機能を優先実装
2. **段階的リリース**: MVP → 機能追加の段階的アプローチ
3. **定期的なアーキテクチャレビュー**: DDD実装の適切性確認

---

## 推定総工数
**合計推定工数**: 約 **126時間** (約16人日)

### フェーズ別工数
- フェーズ1 (基盤構築): 10時間
- フェーズ2 (ドメイン層): 17時間
- フェーズ3 (アプリケーション層): 10時間
- フェーズ4 (インフラ層): 20時間
- フェーズ5 (プレゼンテーション層): 20時間
- フェーズ6 (フロント基盤): 10時間
- フェーズ7 (PMO機能): 18時間
- フェーズ8 (開発者機能): 18時間
- フェーズ9 (品質保証): 18時間
- フェーズ10 (運用準備): 12時間

### 推奨チーム構成
- **バックエンドエンジニア**: 1名 (Java + Spring Boot + DDD経験)
- **フロントエンドエンジニア**: 1名 (Vue 3 + TypeScript経験)
- **DevOpsエンジニア**: 1名 (Docker + CI/CD経験)
- **QAエンジニア**: 1名 (テスト自動化経験)

### 開発期間
**推定開発期間**: **3-4週間** (4名チーム、フルタイム開発の場合)