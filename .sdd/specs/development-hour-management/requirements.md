# Requirements Document

## Introduction
製品開発工数管理ツールは、PMO（プロジェクト管理オフィス）と開発者が協働してプロジェクトの工数を効率的に管理・追跡するためのWebアプリケーションシステムです。正確な工数記録により、プロジェクトの透明性向上と組織全体の生産性向上を実現します。

## Requirements

### Requirement 1: プロジェクト管理
**User Story:** PMOとして、複数の開発プロジェクトを一元管理したい。これにより、データドリブンな意思決定と効率的なプロジェクト運営を実現できる。

#### Acceptance Criteria
1. WHEN PMOが新規プロジェクトを作成するとき THEN システムはプロジェクト名、説明、開始日、予定終了日、プロジェクトステータスを入力できるフォームを表示する
2. WHEN プロジェクト作成フォームに必要項目が入力され保存ボタンが押されるとき THEN システムは新規プロジェクトをデータベースに保存し、一意のプロジェクトIDを生成してプロジェクト一覧に表示する
3. IF プロジェクトが作成済みの状態 THEN PMOはプロジェクト情報（名前、説明、期日、ステータス）を編集できる
4. WHEN PMOがプロジェクトステータスを「完了」に変更するとき THEN システムは完了日を記録し、それ以降の工数入力を制限する
5. WHEN PMOがプロジェクト削除を実行するとき THEN システムは確認ダイアログを表示し、承認後にプロジェクトと関連する全ての工数データを論理削除する
6. WHERE プロジェクト一覧画面において システムは各プロジェクトのステータス（計画中、進行中、完了、保留）を表示する
7. WHEN PMOがプロジェクトをフィルタリングするとき THEN システムはステータス、期間、担当開発者による絞り込み機能を提供する

### Requirement 2: 開発者アサイン管理
**User Story:** PMOとして、開発者を適切にプロジェクトにアサインしたい。これにより、プロジェクトチームを適切に編成し、開発体制を整備できる。

#### Acceptance Criteria
1. WHEN PMOがプロジェクトに開発者をアサインするとき THEN システムは利用可能な開発者リスト、役割（開発者、レビュアー、テスター等）、アサイン期間を設定できるフォームを表示する
2. IF 開発者が既に他のプロジェクトにアサインされている場合 THEN システムは現在のアサイン状況を表示する
3. WHEN PMOが開発者のアサインを保存するとき THEN システムはプロジェクトID、ユーザーID、役割、アクティブステータスを紐づけてデータベースに保存する
4. WHEN PMOが開発者のアサインを解除するとき THEN システムはアクティブステータスを「非アクティブ」に更新し、アサイン履歴を保持する
5. WHERE 開発者アサイン画面において システムは開発者ごとの現在のプロジェクト割り当て状況を一覧表示する
6. WHEN 複数のプロジェクトに同一開発者がアサインされているとき THEN システムは並行作業可能なプロジェクトリストを表示する
7. IF 同一プロジェクトに同一開発者を重複してアサインしようとした場合 THEN システムは重複エラーを表示し、アサインを拒否する

### Requirement 3: 工数記録・追跡
**User Story:** 開発者として、日々の作業工数を効率的に記録し、自分の作業履歴を確認したい。これにより、正確な工数報告と生産性の自己管理ができる。

#### Acceptance Criteria
1. WHEN 開発者が工数記録画面を開くとき THEN システムは当日分の工数入力表を表示し、アサインされている案件を行として、作業カテゴリを列として配置した表形式で工数入力フィールドを表示する
2. WHERE 工数入力表において システムは各案件（行）と作業カテゴリ（列）の交差セルに工数入力フィールドを配置し、0.25時間単位での入力を受け付ける
3. WHEN 開発者が工数を入力して保存するとき THEN システムは入力された時間を案件ID、作業カテゴリID、日付、ユーザーIDと紐づけてデータベースに保存する
4. IF 工数の合計が1日の標準労働時間（8時間）を超える場合 THEN システムは警告メッセージを表示するが、保存は許可する
5. WHEN 開発者が過去の工数記録を修正するとき THEN システムは過去30日間の工数記録の修正を許可し、修正履歴を記録する
6. WHERE 工数記録一覧において システムは日別、週別、月別の工数集計を表示する
7. IF 開発者にアサインされた案件が存在しない場合 THEN システムは「現在アサインされている案件がありません」のメッセージを表示する
8. WHEN 開発者が工数記録をコピーするとき THEN システムは前日の工数記録を当日にコピーする機能を提供する

### Requirement 4: 作業カテゴリ管理
**User Story:** PMOとして、作業カテゴリをカスタマイズして組織のニーズに合わせたい。これにより、より詳細な工数分析と改善点の特定ができる。

#### Acceptance Criteria
1. WHEN PMOが作業カテゴリを作成するとき THEN システムはカテゴリコード、カテゴリ名、表示順序を入力できるフォームを表示する
2. IF 作業カテゴリが作成される場合 THEN システムは一意のカテゴリコードを検証し、重複を防ぐ
3. WHEN PMOが作業カテゴリを編集するとき THEN システムはカテゴリ名、表示順序の変更を許可する（カテゴリコードは変更不可）
4. WHERE 作業カテゴリ一覧において システムは表示順序に従ってカテゴリを並べ替えて表示する
5. WHEN PMOが作業カテゴリを削除するとき AND 該当カテゴリに工数記録が存在する場合 THEN システムは削除を拒否し、エラーメッセージを表示する
6. IF 作業カテゴリが削除可能な場合 THEN システムは論理削除を実行し、履歴データは保持する

### Requirement 5: ユーザー管理・認証
**User Story:** 管理者として、ユーザーアカウントとアクセス権限を管理したい。これにより、セキュアな環境で適切な情報アクセスを保証できる。

#### Acceptance Criteria
1. WHEN ユーザーがログインするとき THEN システムはユーザーIDとパスワードによる認証を実行し、JWTトークンを発行する
2. IF ログイン認証が成功した場合 THEN システムはユーザーの役割（PMO/開発者）に応じた適切な画面にリダイレクトする
3. WHEN 管理者が新規ユーザーを作成するとき THEN システムは名前、ユーザーID、役割、初期パスワードを設定できるフォームを表示する
4. WHERE ユーザー一覧画面において システムはユーザーのアクティブ/非アクティブステータス、最終ログイン日時を表示する
5. WHEN ユーザーがパスワードを変更するとき THEN システムは現在のパスワードの確認と新パスワードの強度検証を実行する
6. IF ユーザーが30日間ログインしない場合 THEN システムは自動的にアカウントを非アクティブ化する
7. WHILE ユーザーがシステムを使用している間 システムはJWTトークンの有効性を検証し、期限切れの場合は再認証を要求する

### Requirement 6: システム統合・API
**User Story:** 開発チームとして、外部システムと連携してデータを同期したい。これにより、手動データ入力を削減し、データの一貫性を保てる。

#### Acceptance Criteria
1. WHERE REST APIエンドポイントにおいて システムは全ての主要機能（CRUD操作）をAPI経由で提供する
2. WHEN 外部システムがAPIを呼び出すとき THEN システムはAPIキーまたはOAuth2.0による認証を要求する
3. IF API呼び出しがレート制限を超える場合 THEN システムはHTTP 429ステータスコードを返し、再試行までの待機時間を通知する
4. WHEN データインポート機能が使用されるとき THEN システムはCSV/JSON形式でのプロジェクト、ユーザー、工数データの一括インポートを受け付ける
5. WHERE APIレスポンスにおいて システムは標準的なJSONフォーマットでデータを返し、適切なHTTPステータスコードを使用する
6. WHEN Webhook設定が有効な場合 THEN システムは重要なイベント（プロジェクト完了、工数承認等）を外部システムに通知する

### Requirement 7: パフォーマンス・非機能要件
**User Story:** 全ユーザーとして、高速で信頼性の高いシステムを使用したい。これにより、ストレスなく日常業務を遂行できる。

#### Acceptance Criteria
1. WHILE システムが稼働している間 システムは99.9%の可用性を維持する
2. WHEN ユーザーが画面遷移するとき THEN システムは3秒以内にページを表示する
3. WHERE データベースクエリにおいて システムは1000件のレコード取得を1秒以内に完了する
4. IF 同時接続ユーザー数が100人を超える場合でも THEN システムはレスポンス時間の劣化を20%以内に抑える
5. WHEN システムバックアップが実行されるとき THEN システムは日次で自動バックアップを実行し、30日間のデータを保持する
6. WHERE セキュリティ対策において システムはOWASP Top 10の脆弱性に対する防御を実装する
7. IF システムエラーが発生した場合 THEN システムは詳細なエラーログを記録し、管理者に通知する
8. WHEN データベース接続が失敗した場合 THEN システムは自動的に再接続を試行し、サーキットブレーカーパターンを適用する